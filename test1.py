import geopandas
from shapely import wkt
from shapely.geometry import LineString
from shapely.ops import linemerge

from src.util.merging_utils import lonlat_length_in_km

test1 = wkt.loads(
    "MULTILINESTRING((121.50253710000001 25.0639599,121.5011783 25.0634632,121.4998922 25.062993699999993,121.4988069 25.0625972,121.49845419999998 25.062468300000006,121.4978641 25.062252599999994,121.49704610000002 25.06195399999997,121.4968546 25.061889900000025,121.4966589 25.061833400000012,121.496471 25.061781800000034,121.49629040000002 25.06174400000002,121.49557410000001 25.061626199999992,121.49477250000001 25.06149889999999,121.4942375 25.06141030000002,121.49403769999999 25.061373400000008,121.4937085 25.061354300000033,121.49338280000002 25.061305699999963,121.4931842 25.061256,121.49310029999998 25.061236199999996,121.4929892 25.0611789,121.4929131 25.061134300000006,121.49284409999999 25.061062800000002,121.4927856 25.060979900000007,121.4927287 25.060846400000003,121.4926969 25.060790200000014,121.4925785 25.060690599999987,121.49227020000001 25.06046870000003,121.49168040000002 25.060053600000003,121.4909778 25.059556400000005,121.4909117 25.05951180000001,121.4905523 25.059264400000004,121.4894505 25.058505699999998,121.4893874 25.058462200000008,121.48933649999998 25.058426900000015,121.4894778 25.05837739999997,121.48937459999999 25.05830709999998,121.4894552 25.05823129999999,121.4896773 25.058081700000002,121.48969110000002 25.0580724,121.4897926 25.058011899999997,121.4900204 25.057889099999997,121.4900695 25.0578625,121.4901876 25.05779849999999,121.4902694 25.057753000000005,121.49028850000002 25.0577423,121.49041490000002 25.057657300000017,121.4905518 25.05754500000002,121.49076910000001 25.0573507,121.49111750000002 25.057039000000017,121.49145219999998 25.056734500000033,121.4917946 25.056452899999996,121.4921301 25.0562113,121.49233279999999 25.056073499999997,121.49255700000002 25.055921099999992,121.49273800000002 25.055800500000018,121.4928362 25.055735099999993,121.49295340000002 25.055670800000016,121.49308150000002 25.055611999999996,121.49312780000001 25.055590800000033,121.49333689999999 25.055510400000003,121.49362529999999 25.055423999999988,121.4937366 25.055390200000005,121.4939537 25.0553144,121.49422939999998 25.0551969,121.4943706 25.055138,121.4950558 25.0548649,121.4960258 25.054466500000004,121.49630940000002 25.054320599999997,121.49647770000001 25.0542356,121.4966866 25.0541609,121.49990609999999 25.052368599999994,121.5031336 25.050571799999986,121.50374809999998 25.050207599999993,121.5038893 25.050163099999992,121.50479660000002 25.049660700000004,121.5052403 25.04939619999999,121.5055429 25.049224500000008,121.5057587 25.049110600000006,121.5058961 25.049041099999997,121.5060592 25.0489783,121.5062718 25.048921399999998,121.5063718 25.048865899999996,121.50744549999999 25.048604499999996,121.50750320000002 25.048589199999995,121.50759110000001 25.048567899999995,121.5076097 25.048565999999994,121.5077134 25.0485403,121.50781230000001 25.048515800000004,121.50797429999999 25.048476399999984,121.5086032 25.0483232,121.5087965 25.048271299999996,121.5093559 25.048148900000015,121.50959080000001 25.048111699999993,121.5098712 25.04809059999998,121.5100212 25.04808270000001,121.5101493 25.0480807,121.5103013 25.048074400000004,121.5106991 25.04806260000001,121.51108439999999 25.048042400000014,121.5112158 25.0480199,121.51127740000001 25.048005900000007,121.5113427 25.047990999999996,121.5114083 25.0479687,121.51163439999999 25.047842200000005,121.5117261 25.047775700000017,121.5118166 25.047701599999996,121.5118709 25.047657900000033,121.5119795 25.047587399999998,121.5121217 25.047515700000005,121.5122505 25.047461000000013,121.5128033 25.0473013,121.5131139 25.047224400000005,121.5132706 25.047186000000025,121.5134166 25.047151999999997,121.51364870000002 25.047095000000013,121.5142198 25.046954599999964,121.514905 25.046786200000014,121.51501710000001 25.046758699999984,121.5151795 25.046720599999986,121.51563580000001 25.046607199999997,121.5161248 25.046485700000005,121.5174682 25.046148200000005,121.51747869999998 25.04614699999999,121.51912210000002 25.0456813,121.5192052 25.045664399999993,121.51944810000002 25.045614999999984,121.5195342 25.04560330000001,121.5196109 25.04577189999999,121.519653 25.04586069999999,121.5201976 25.04700859999997,121.5202552 25.047129999999996,121.5203112 25.0472417,121.520368 25.047370799999996,121.5203797 25.04739570000001,121.5206204 25.047907100000003,121.5206667 25.048006600000008,121.5207482 25.0481834,121.5207864 25.04825769999998,121.52079430000002 25.048273100000003,121.5208143 25.048312699999997,121.5212333 25.049143200000017,121.5215381 25.049745700000017,121.5215407 25.049750700000004,121.521585 25.049836400000004,121.5216496 25.0499772,121.52165260000001 25.049983899999987,121.52210900000001 25.050966899999963,121.52228480000001 25.051394599999995,121.522357 25.051616800000005,121.52248499999999 25.052060299999994,121.52250769999999 25.052182700000003,121.52252430000001 25.052297299999978,121.52254449999998 25.05247200000001,121.5226689 25.054886900000014,121.5226761 25.05499659999998,121.52268200000002 25.055092000000002,121.52282450000001 25.0577763,121.52282859999998 25.057889700000004,121.52283170000001 25.057969999999983,121.5228391 25.058091100000013,121.52292180000002 25.06019110000001,121.5229224 25.060206600000015,121.5229274 25.060330300000004,121.5229295 25.060414800000018,121.52294 25.0608462,121.52291920000002 25.0612098,121.52288139999999 25.061474499999974,121.5228279 25.061757099999994,121.52263469999998 25.062576300000003,121.52260480000001 25.06269860000002,121.52251949999999 25.062701199999992,121.52248810000002 25.062843600000008,121.5224544 25.062985200000014,121.52233019999998 25.063506899999993,121.5222539 25.06386660000001,121.5222434 25.063939599999983,121.5222191 25.064087200000017,121.5222091 25.064166799999995,121.5221884 25.06434230000002,121.52216729999999 25.064496899999995,121.5221473 25.064762099999996,121.5221469 25.064797499999997,121.52214600000002 25.064888699999997,121.5221456 25.064962400000027,121.5221441 25.06528679999998,121.5221491 25.065498599999984,121.52216159999999 25.065747700000003,121.5221746 25.066002099999977,121.5222091 25.06629320000002,121.52226269999998 25.066595100000015,121.5222973 25.066777900000005,121.5222984 25.06678220000002,121.52231980000002 25.066867500000015,121.5223396 25.066941699999987,121.5227074 25.068318900000023,121.5227321 25.068405800000008,121.52275499999999 25.068489200000002,121.522796 25.068630999999996,121.52305710000002 25.069634899999997,121.52333229999999 25.070645099999993,121.5234081 25.07076619999998,121.5234229 25.07063559999999,121.5228697 25.068615199999982,121.5228348 25.068487700000006,121.5228138 25.068403899999993,121.5227916 25.068318500000004,121.5224974 25.0672225,121.5224205 25.066922100000014,121.52240209999998 25.066850099999968,121.5223849 25.066766700000002,121.5223659 25.06667410000003,121.52229799999999 25.066308200000023,121.52225000000001 25.06590750000001,121.522239 25.065751199999994,121.52222960000002 25.065626100000003,121.52222390000001 25.065354799999994,121.52222670000002 25.06497179999998,121.5222272 25.06490220000002,121.5222335 25.06481180000003,121.52223390000002 25.06480219999999,121.5222444 25.06457740000002,121.52226129999998 25.064411500000006,121.5223107 25.06402990000001,121.5223363 25.0638802,121.52236640000001 25.06373040000001,121.52254239999999 25.062981199999996,121.52257460000001 25.0628416,121.52260480000001 25.06269860000002,121.5226612 25.062696999999986,121.5226925 25.062575199999998,121.5228984 25.061750500000002,121.5229444 25.061482999999996,121.5229827 25.0611667,121.5230017 25.060840900000017,121.52299250000002 25.060413100000005,121.52299100000002 25.060344200000003,121.5229849 25.060203099999995,121.5228942 25.0580894,121.5228883 25.057974399999978,121.5228853 25.057896500000012,121.5228752 25.0577756,121.52273940000002 25.055086999999972,121.52273370000002 25.05499379999999,121.52272680000002 25.054885,121.5226052 25.052477600000017,121.5225845 25.05228850000003,121.5225619 25.052173699999983,121.52253550000002 25.05205260000001,121.52241200000002 25.051604699999984,121.5223424 25.051388499999987,121.52216939999998 25.050952299999977,121.52198959999998 25.050541600000003,121.5217381 25.050008800000015,121.5217148 25.0499583,121.5217118 25.04995160000003,121.52165179999999 25.049820299999993,121.52160350000001 25.0497249,121.52160090000001 25.0497199,121.5212909 25.049101300000004,121.5208568 25.048249,121.5208488 25.048233600000017,121.5208169 25.048171999999994,121.52073110000002 25.047995600000007,121.52068389999998 25.04789360000001,121.5206549 25.047828899999985,121.5204398 25.047348700000015,121.520368 25.047210199999995,121.5203324 25.04713319999999,121.52026870000002 25.04699579999999,121.52025980000002 25.046976599999994,121.5196924 25.045753099999985,121.5196109 25.04577189999999,121.51952709999999 25.045787500000017,121.51944810000002 25.045614999999984,121.5194092 25.045482300000003,121.5193357 25.0452322,121.5192569 25.044945899999973,121.51918219999999 25.044674299999997,121.5191735 25.04464259999999,121.51914710000001 25.044546399999987,121.5191189 25.044452099999987,121.51906469999999 25.044256699999977,121.51894690000002 25.04386879999997,121.5188988 25.04371049999999,121.51882749999999 25.043475700000016,121.51881970000001 25.043449800000005,121.51879 25.043350200000006,121.5187549 25.043226599999983,121.5187395 25.043173100000033,121.51849489999998 25.042310999999998,121.51846550000002 25.042207599999998,121.5184244 25.04206640000001,121.5184082 25.0420058,121.5183918 25.041947999999977,121.5183571 25.041829599999986,121.5182862 25.041587800000002,121.5180955 25.040937599999992,121.51807179999999 25.040856899999994,121.51803100000001 25.040717799999996,121.5180038 25.040626900000007,121.5176835 25.03955500000002,121.5176749 25.039526300000006,121.51764230000002 25.039416599999996),(121.51764230000002 25.039416599999996,121.51774039999998 25.039413200000013,121.5178056 25.039400000000015,121.51788850000001 25.039368999999994,121.5179053 25.039360399999993,121.5179892 25.039302799999987,121.51805620000002 25.0392291,121.5181101 25.039122899999995,121.5181288 25.039008699999997,121.5181118 25.038894199999987,121.5180604 25.03878859999999,121.51797869999999 25.038700000000006,121.5178544 25.038633599999997,121.51776479999998 25.038602300000008,121.5176763 25.03859410000001,121.5176129 25.03859779999999,121.51755070000002 25.0386096,121.5174305 25.038658400000003,121.51735119999998 25.038716300000004,121.51728820000001 25.038788800000006,121.51724450000002 25.038872099999978,121.5172225 25.038962200000014,121.5172231 25.03905449999999,121.517234 25.039107699999974,121.5172526 25.0391592,121.5172784 25.039207999999988,121.5173449 25.039289499999995,121.5174314 25.0393538,121.5175326 25.039397000000008,121.51764230000002 25.039416599999996))")
# %%

coastline = geopandas.read_file("data/output/coastline/Taiwan/coastline.geojson", sep="\t")
coastline["length"] = coastline.apply(lambda row: lonlat_length_in_km(row["geometry"]), axis=1)
coastline = coastline[lonlat_length_in_km(coastline["geometry"]) > 70]
coastline.drop(76, inplace=True)
coastline.drop(82, inplace=True)

coastline["order"] = 0
current_order = 1
